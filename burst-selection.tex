\subsection{Burst Selection}
\label{sec:burstsel}

After burst search, it is common to select bursts according to different
criteria. One of the most common is burst size.

For instance, to select bursts with more than 30 photons detected during the donor excitation 
(computed after background correction), we use following command:

\begin{lstlisting}
ds = d.select_bursts(select_bursts.size, th1=30)
\end{lstlisting}

The previous command creates a new \verb|Data| variable (\verb|ds|) containing
the selected bursts. \verb|th1| defines the lower bound for burst size, while 
\verb|th2| defines the upper bound (when not specified, as in the previous example,
the upper bound is $+\infty$).
As before, the new object will share the photon data
arrays with the original object (\verb|d|) in order to minimize the amount 
of used memory.

The first argument of \verb|select_bursts|
(\href{http://fretbursts.readthedocs.org/en/latest/data_class.html#burst-selection-methods}{link})
is a python function implementing the ``selection rule'' (\verb|select_bursts.size| in this example);
all remaining arguments (only \verb|th1| in this case) are parameters of the selection rule.
The \verb|select_bursts| module
(\href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html}{link})
contains numerous built-in selection functions
(\href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html#module-fretbursts.select_bursts}{link}).
For example,
\verb|select_bursts.ES|
is used to select a region on the E-S ALEX histogram,
\verb|select_bursts.width|
to select bursts based on their duration.
New custom criteria can be readily implemented by defining a new selection function,
which requires only a couple of lines of code (see the
\verb|select_bursts| module's source code for examples,
\href{https://github.com/tritemio/FRETBursts/blob/master/fretbursts/select_bursts.py}{link}).

Finally, different criteria can be combined sequentially.
For example, the following commands:

\begin{lstlisting}
ds = d.select_bursts(select_bursts.size,
                     th1=50, th2=200)
dsw = ds.select_bursts(select_bursts.width,
                       th1=0.5e-3, th2=3e-3)
\end{lstlisting}

apply both a burst size and a burst duration selection criterion, in which bursts
have sizes between 50 and 200 photons, and duration between 0.5 and 3~ms.

\subsubsection{Burst Size Selection}

In the previous section, we selected bursts by size, using only Dex photons
(i.e. photons detected in both D and A channels during D excitation, as in eq.~\ref{eq:burstsize_dex}).
Alternatively, a threshold on the burst size computed including all photons 
can be applied by adding $n_{aa}$ to the burst size (see eq.~\ref{eq:burstsize_allph}). 
This is achieved
by passing \verb|add_naa=True| to the selection function. When \verb|add_naa| is not specified,
as in the previous section, the default \verb|add_naa=False| is used
(i.e. computed size using only Dex photons). 
The complete selection command is:

\begin{lstlisting}
ds = d.select_bursts(select_bursts.size,
                     th1=30, add_naa=True)
\end{lstlisting}

\noindent The result of this selection is plotted in figure~\ref{fig:alex_jointplot}.

Another important parameter for defining the burst size is the $\gamma$-factor, i.e.
the imbalance between the donor and the acceptor channel signals. As noted in
section~\ref{sec:burstsizeweights}, the $\gamma$-factor is
used to compensate bias for the different fluorescence quantum yields of the D and A
fluorophores as well as the different photon-detection efficiencies of the D and A channels.
When $\gamma$ is significantly different from 1, neglecting its effect on burst size leads to
over-representing (in terms of number of bursts) one FRET population versus the others.

When the $\gamma$ factor is known, a more unbiased selection of different FRET
populations can be achieved passing the argument \verb|gamma| to the 
selection function:

\begin{lstlisting}
ds = d.select_bursts(select_bursts.size,
                     th1=15, gamma=0.65)
\end{lstlisting}

When not specified, $\gamma=1$ is assumed.

For more details on burst size selection, see the
\verb|select_bursts.size| documentation
(\href{http://fretbursts.readthedocs.org/en/latest/burst_selection.html#fretbursts.select_bursts.size}{link}).

\paragraph{Python details} 
To compute $\gamma$-corrected burst sizes (with or without addition of \verb|naa|) 
the method \verb|Data.burst_sizes|
(\href{http://fretbursts.readthedocs.org/en/latest/data_class.html#fretbursts.burstlib.Data.burst_sizes}{link})
is used.

\subsubsection{Select the FRET Populations}

In smFRET-ALEX experiments, in addition to one or more FRET populations, there are always
donor-only (D-only) and acceptor-only (A-only) populations.
In most cases, these additional populations are not of interest and need to be filtered out.

In principle, using the E-S representation, D-only and A-only bursts
can be excluded by selecting bursts within a range of $S$ values (e.g. S=0.2-0.8). 
This approach, however, simply truncates the burst distribution with arbitrary
thresholds and is therefore not recommended for quantitative assessment of FRET
populations.

An alternative approach consists in applying two selection filters sequentially.
First, the A-only population is filtered out
by applying a threshold on the number of photons during D excitation.
Second, the D-only population is filtered out by applying a threshold on 
the number of photons during A excitation.
The commands for these combined selections are:

\begin{lstlisting}
ds1 = d.select_bursts(select_bursts.size, th1=15)
ds2 = ds1.select_bursts(select_bursts.naa, th1=15)
\end{lstlisting}

Here, variable \verb|ds2| contains the combined burst selection.
Figure~\ref{fig:alex_jointplot_fretsel} shows the resulting pure FRET
population obtained with the previous selection.
